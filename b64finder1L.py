#!/usr/bin/env python
#copyrighted by RemsFlems.
import base64,sys,os;e2=10;e3=4;e4=60;inputf=open(sys.argv[1],'rb');tm=os.stat(sys.argv[1]).st_size;exec("try: \n\t e2=int(sys.argv[2]) \n\t e3=int(sys.argv[3]) \n\t e4=int(sys.argv[4]) \nexcept: pass");rs="";bs=1;rsb=[];fd=0;ts=0;os.system('clear');print "Base64 pattern finder";exec("def displayer(rs,rsb,e2): \n\t print '\\n[MOST PROBABLE]: ['+rs.replace('\\n','\\\n')+']'; rsb.sort(lambda x,y: cmp(len(y),len(x))); \n\t try: \n\t\t rk=int(e2); \n\t except: rk=15; \n\t o=[v.replace('\\n','\\\n')+']' for v in rsb[:rk] if v!=rs]; \n\t for p in o: \n\t\t print '[other]: ['+str(p) \n\t sys.exit()");tu=0;prt=str('\r[Found]:'+ str(fd)+' [Trusts]:'+ str(ts)+' [Progress]:' + str(round(float(tu)/tm*100,4)) + '%');exec('sys.stdout.write(prt)');sys.stdout.flush();exec("while 1: \n\t try: \n\t\t a=inputf.read(10000); \n\t\t if not a: prt=str('\\r[Found]:'+ str(fd)+' [Trusts]:'+ str(ts)+' [Progress]:' + str(round(float(tu)/tm*100,4)) + '%');exec('sys.stdout.write(prt)');displayer(rs,rsb,e2); \n\t\t sz=len(a);tu=tu+sz; \n\t\t for t in xrange(e4,e3,-1): \n\t\t\t for s in range(sz-t): \n\t\t\t\t try: \n\t\t\t\t\t dcd=base64.b64decode(a[s:s+t]);rcd=base64.b64encode(dcd);ai=''.join([x if ord(x)<128 else '?' for x in dcd]) \n\t\t\t\t\t if rcd==a[s:s+t] and '?' not in ai and isinstance(dcd, str): \n\t\t\t\t\t\t e=0; \n\t\t\t\t\t\t for i,c in enumerate(rsb): \n\t\t\t\t\t\t\t if ai in c: e=1; ts=ts+1; \n\t\t\t\t\t\t\t if c in ai: e=2; sb[i]=ai; bs=len(ai);rs=ai if len(ai) > bs else True; \n\t\t\t\t\t\t if e==0: fd=fd+1;rsb.append(ai);exec('if len(ai) > bs: bs=len(ai);rs=ai;') \n\t\t\t\t except KeyboardInterrupt: displayer(rs,rsb,e2); \n\t\t\t\t except: pass \n\t\t\t\t prt=str('\\r[Found]:'+ str(fd)+' [Trusts]:'+ str(ts)+' [Progress]:' + str(round(float(tu)/tm*100,4)) + '%');exec('sys.stdout.write(prt)');sys.stdout.flush(); \n\t except KeyboardInterrupt: prt=str('\\r[Found]:'+ str(fd)+' [Trusts]:'+ str(ts)+' [Progress]:' + str(round(float(tu)/tm*100,4)) + '%');exec('sys.stdout.write(prt)');displayer(rs,rsb,e2)")

